---
import Section from "./Section.astro";
import { Image } from "astro:assets";
import type { HackathonProps } from "@types";

interface Props {
    hackathons: HackathonProps[];
}

const { hackathons } = Astro.props;
---

<Section text="Hackathons" href="hackathons">
    {
        hackathons.map(
            (
                { name, location, summary, rank, images, link, preview },
                index,
            ) => {
                // Reduced stack offset like projects
                const top = 100 + index * 10;
                const zIndex = index + 1;
                const displayImages = images ? images.slice(0, 3) : [];
                const hasImages = displayImages.length > 0;

                return (
                    <div
                        style={`--sticky-top: ${top}px; z-index: ${zIndex};`}
                        class="relative mb-12 rounded-2xl border border-neutral/20 bg-black transition-all duration-500 ease-out sm:sticky sm:top-[var(--sticky-top)]"
                    >
                        <div class="bg-difu relative z-[1] flex flex-col rounded-2xl bg-[#1c232d]/85 before:absolute before:inset-0 before:z-[-1] before:rounded-2xl before:bg-[url(/raja.png)] before:bg-[length:128px] before:bg-repeat before:opacity-[5%] before:content-[''] sm:grid sm:min-h-0 sm:grid-cols-2 sm:grid-rows-1">
                            {/* Content Side */}
                            <div class="flex shrink-0 flex-col px-6 pt-10 pb-6 sm:justify-between sm:py-12">
                                <div>
                                    <div class="mb-4 flex flex-wrap items-center gap-3">
                                        <h3 class="font-serif text-3xl font-medium text-primary">
                                            {name}
                                        </h3>
                                        {rank && (
                                            <span class="text-primary-300 rounded-full border border-primary/30 bg-primary/20 px-3 py-1 text-xs font-semibold text-primary">
                                                {rank}
                                            </span>
                                        )}
                                    </div>

                                    <div class="mb-4 flex items-center gap-2 text-sm text-neutral-400">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-4 w-4"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                            stroke="currentColor"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                                            />
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                                            />
                                        </svg>
                                        {location}
                                    </div>

                                    <p class="text-base text-neutral">
                                        {summary}
                                    </p>
                                </div>

                                <div class="flex gap-5 pt-8 text-white">
                                    {link && (
                                        <a
                                            href={link}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class="flex items-center gap-2 rounded-lg bg-white/5 px-4 py-2 text-sm transition-colors hover:bg-white/10 active:scale-95 sm:bg-transparent sm:p-0 sm:text-base sm:after:relative sm:after:bottom-[-5px] sm:after:content-[url(/external.svg)] sm:hover:bg-transparent sm:hover:underline"
                                        >
                                            <span class="sm:hidden">
                                                <img
                                                    src="/external.svg"
                                                    alt=""
                                                    class="h-4 w-4 invert"
                                                />
                                            </span>
                                            View Code
                                        </a>
                                    )}
                                    {preview && (
                                        <a
                                            href={preview}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class="flex items-center gap-2 rounded-lg bg-white/5 px-4 py-2 text-sm transition-colors hover:bg-white/10 active:scale-95 sm:bg-transparent sm:p-0 sm:text-base sm:after:relative sm:after:bottom-[-5px] sm:after:content-[url(/external.svg)] sm:hover:bg-transparent sm:hover:underline"
                                        >
                                            <span class="sm:hidden">
                                                <img
                                                    src="/external.svg"
                                                    alt=""
                                                    class="h-4 w-4 invert"
                                                />
                                            </span>
                                            Live Demo
                                        </a>
                                    )}
                                </div>
                            </div>

                            {/* Image Side */}
                            <div class="flex w-full items-center justify-center p-4 sm:h-auto">
                                {hasImages && (
                                    <div
                                        class={`grid w-full gap-2 ${
                                            displayImages.length === 1
                                                ? "grid-cols-1"
                                                : displayImages.length === 2
                                                  ? "grid-cols-1 sm:grid-cols-2"
                                                  : "grid-cols-1 sm:grid-cols-2 sm:grid-rows-2"
                                        }`}
                                    >
                                        {displayImages.map((img, imgIndex) => {
                                            let gridClass =
                                                "overflow-hidden rounded-xl shadow-lg relative min-h-[200px] sm:min-h-0";

                                            // 3 Images Layout:
                                            // Mobile: Stacked (via grid-cols-1 above)
                                            // Desktop: Top one full width, Bottom two split
                                            if (displayImages.length === 3) {
                                                if (imgIndex === 0) {
                                                    gridClass +=
                                                        " sm:col-span-2 sm:row-span-1";
                                                } else {
                                                    gridClass +=
                                                        " sm:col-span-1 sm:row-span-1";
                                                }
                                            }
                                            // 2 Images Layout:
                                            // Desktop: Side by side (col-span-1 each)
                                            else if (
                                                displayImages.length === 2
                                            ) {
                                                gridClass += " sm:col-span-1";
                                            }
                                            // 1 Image:
                                            else {
                                                gridClass +=
                                                    " h-[300px] sm:h-full";
                                            }

                                            return (
                                                <div class={gridClass}>
                                                    <Image
                                                        src={img}
                                                        alt={`${name} screenshot ${imgIndex + 1}`}
                                                        width={500}
                                                        height={300}
                                                        class="h-full w-full object-cover object-top transition-transform duration-500 hover:scale-105"
                                                    />
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            },
        )
    }
</Section>
